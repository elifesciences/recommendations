#!/usr/bin/env php
<?php
umask(002);
require_once __DIR__ . '/../vendor/autoload.php';
set_time_limit(0);
use eLife\App\Kernel;
use Symfony\Component\Console\Input\ArgvInput;

$input = new ArgvInput();

$env = $input->getParameterOption(array('--env', '-e'), getenv('SYMFONY_ENV') ?: 'local');
$file = $input->getFirstArgument();

if (!file_exists(__DIR__ . '/../config/' . $env . '.php')) {
    echo 'Environment `' . $env . '` not found. Specify one with --env=$env', PHP_EOL;
    exit(1);
}

$config = require __DIR__ . '/../config/' . $env . '.php';
$app = new Kernel($config);

$query = file_get_contents(__DIR__ . '/queries/' . $file . '.sql');

/** @var \Doctrine\DBAL\Connection $connection */
$connection = $app->get('db');

$result = $connection->prepare($query);
$result->execute();

print $result->rowCount();
